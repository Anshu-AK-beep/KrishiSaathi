// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  url      = env("DATABASE_URL")
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==============================================
// USER MANAGEMENT & AUTHENTICATION
// ==============================================

model User {
  id            String   @id @default(uuid()) @db.Uuid
  email         String   @unique
  phoneNumber   String?  @map("phone_number")
  countryCode   String?  @default("+91") @map("country_code")
  fullName      String?  @map("full_name")
  isVerified    Boolean  @default(false) @map("is_verified")
  isActive      Boolean  @default(true) @map("is_active")
  role          UserRole @default(FARMER)
  languagePreference String @default("en") @map("language_preference")
  lastLogin     DateTime? @map("last_login")
  
  // Timestamps
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  // Relations
  preferences   UserPreferences?
  farms         Farm[]
  predictions   CropPrediction[]
  auditLogs     AuditLog[]
  notifications Notification[]
  
  @@index([email])
  @@index([phoneNumber])
  @@index([role])
  @@index([isActive])
  @@map("users")
}

model UserPreferences {
  id                        String   @id @default(uuid()) @db.Uuid
  userId                    String   @unique @map("user_id") @db.Uuid
  user                      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Language and Theme
  language                  String   @default("en")
  theme                     Theme    @default(LIGHT)
  
  // Notification Preferences
  notificationsSms          Boolean  @default(false) @map("notifications_sms")
  notificationsPush         Boolean  @default(true) @map("notifications_push")
  notificationsEmail        Boolean  @default(true) @map("notifications_email")
  
  // Accessibility Settings
  accessibilityScreenReader Boolean  @default(false) @map("accessibility_screen_reader")
  accessibilityHighContrast Boolean  @default(false) @map("accessibility_high_contrast")
  accessibilityLargeText    Boolean  @default(false) @map("accessibility_large_text")
  accessibilityVoiceInput   Boolean  @default(false) @map("accessibility_voice_input")
  
  // Timestamps
  createdAt                 DateTime @default(now()) @map("created_at")
  updatedAt                 DateTime @updatedAt @map("updated_at")
  
  @@map("user_preferences")
}

// ==============================================
// FARM MANAGEMENT
// ==============================================

model Farm {
  id                      String        @id @default(uuid()) @db.Uuid
  userId                  String        @map("user_id") @db.Uuid
  user                    User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Basic Information
  name                    String
  location                String
  latitude                Decimal?      @db.Decimal(10, 8)
  longitude               Decimal?      @db.Decimal(11, 8)
  totalArea               Decimal       @map("total_area") @db.Decimal(10, 2) // in acres
  
  // Soil Information
  soilType                SoilType      @map("soil_type")
  soilPh                  Decimal?      @map("soil_ph") @db.Decimal(3, 1)
  
  // Farming Details
  irrigationType          IrrigationType @map("irrigation_type")
  farmOwnership           FarmOwnership  @map("farm_ownership")
  farmingType             FarmingType    @map("farming_type")
  primaryCrops            String[]       @map("primary_crops")
  farmingExperienceYears  Int?           @map("farming_experience_years")
  
  // Status
  isActive                Boolean       @default(true) @map("is_active")
  
  // Timestamps
  createdAt               DateTime      @default(now()) @map("created_at")
  updatedAt               DateTime      @updatedAt @map("updated_at")
  
  // Relations
  predictions             CropPrediction[]
  
  @@index([userId])
  @@index([location])
  @@index([isActive])
  @@map("farms")
}

// ==============================================
// CROP PREDICTION SYSTEM
// ==============================================

model CropPrediction {
  id                      String            @id @default(uuid()) @db.Uuid
  userId                  String            @map("user_id") @db.Uuid
  user                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  farmId                  String            @map("farm_id") @db.Uuid
  farm                    Farm              @relation(fields: [farmId], references: [id], onDelete: Cascade)
  
  // Crop Information
  cropType                String            @map("crop_type")
  cropVariety             String?           @map("crop_variety")
  cropCategory            CropCategory      @map("crop_category")
  
  // Field Details
  fieldArea               Decimal           @map("field_area") @db.Decimal(10, 2) // in acres
  soilType                String?           @map("soil_type")
  soilPh                  Decimal?          @map("soil_ph") @db.Decimal(3, 1)
  
  // Irrigation
  irrigationType          String?           @map("irrigation_type")
  irrigationFrequency     Int?              @map("irrigation_frequency") // times per week
  
  // Farming Practices
  fertilizerType          FertilizerType    @map("fertilizer_type")
  fertilizerQuantity      Decimal?          @map("fertilizer_quantity") @db.Decimal(8, 2) // kg/acre
  pesticideUsed           Boolean           @default(false) @map("pesticide_used")
  pestControlMethod       String?           @map("pest_control_method")
  seedQuality             SeedQuality       @map("seed_quality")
  previousCrop            String?           @map("previous_crop")
  
  // Timeline
  plantingDate            DateTime          @map("planting_date")
  expectedHarvestDate     DateTime          @map("expected_harvest_date")
  actualHarvestDate       DateTime?         @map("actual_harvest_date")
  
  // Weather Data
  avgTemperature          Decimal?          @map("avg_temperature") @db.Decimal(5, 2) // Celsius
  totalRainfall           Decimal?          @map("total_rainfall") @db.Decimal(8, 2) // mm
  humidityLevel           Decimal?          @map("humidity_level") @db.Decimal(5, 2) // percentage 0-100
  weatherData             Json?             @map("weather_data")
  
  // Predictions
  predictedYield          Decimal           @map("predicted_yield") @db.Decimal(10, 2) // quintals
  predictedYieldMin       Decimal?          @map("predicted_yield_min") @db.Decimal(10, 2)
  predictedYieldMax       Decimal?          @map("predicted_yield_max") @db.Decimal(10, 2)
  confidenceLevel         Decimal           @map("confidence_level") @db.Decimal(5, 2) // percentage 0-100
  
  // Results
  actualYield             Decimal?          @map("actual_yield") @db.Decimal(10, 2) // quintals
  accuracyPercentage      Decimal?          @map("accuracy_percentage") @db.Decimal(5, 2)
  
  // AI Analysis
  recommendations         Json?             // AI recommendations
  riskFactors            Json?             @map("risk_factors")
  keyFactors             Json?             @map("key_factors")
  
  // Input Method and Status
  inputMethod            InputMethod       @default(MANUAL) @map("input_method")
  predictionStatus       PredictionStatus  @default(COMPLETED) @map("prediction_status")
  
  // Timestamps
  createdAt              DateTime          @default(now()) @map("created_at")
  updatedAt              DateTime          @updatedAt @map("updated_at")
  
  @@index([userId])
  @@index([farmId])
  @@index([cropType])
  @@index([createdAt])
  @@index([predictionStatus])
  @@map("crop_predictions")
}

// ==============================================
// WEATHER DATA INTEGRATION
// ==============================================

model WeatherData {
  id                String        @id @default(uuid()) @db.Uuid
  location          String
  latitude          Decimal       @db.Decimal(10, 8)
  longitude         Decimal       @db.Decimal(11, 8)
  
  // Weather Information
  date              DateTime
  temperature       Decimal?      @db.Decimal(5, 2)
  temperatureMin    Decimal?      @map("temperature_min") @db.Decimal(5, 2)
  temperatureMax    Decimal?      @map("temperature_max") @db.Decimal(5, 2)
  humidity          Decimal?      @db.Decimal(5, 2)
  rainfall          Decimal?      @db.Decimal(8, 2)
  windSpeed         Decimal?      @map("wind_speed") @db.Decimal(5, 2)
  weatherCondition  String?       @map("weather_condition")
  
  // Extended Data
  forecastData      Json?         @map("forecast_data") // 7-day forecast
  rawData           Json?         @map("raw_data") // complete API response
  
  // Metadata
  dataSource        DataSource    @default(PRIMARY_API) @map("data_source")
  isForecast        Boolean       @default(false) @map("is_forecast")
  expiresAt         DateTime?     @map("expires_at")
  
  // Timestamps
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")
  
  @@index([location])
  @@index([date])
  @@index([expiresAt])
  @@map("weather_data")
}

// ==============================================
// AUDIT & LOGGING
// ==============================================

model AuditLog {
  id            String      @id @default(uuid()) @db.Uuid
  userId        String?     @map("user_id") @db.Uuid
  user          User?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  // Action Details
  action        String
  entityType    String      @map("entity_type")
  entityId      String?     @map("entity_id")
  oldValues     Json?       @map("old_values")
  newValues     Json?       @map("new_values")
  
  // Request Context
  ipAddress     String?     @map("ip_address")
  userAgent     String?     @map("user_agent")
  
  // Status
  status        AuditStatus
  errorMessage  String?     @map("error_message")
  
  // Timestamp
  createdAt     DateTime    @default(now()) @map("created_at")
  
  @@index([userId])
  @@index([entityType])
  @@index([createdAt])
  @@map("audit_logs")
}

// ==============================================
// NOTIFICATIONS
// ==============================================

model Notification {
  id        String           @id @default(uuid()) @db.Uuid
  userId    String           @map("user_id") @db.Uuid
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Notification Content
  title     String
  message   String
  type      NotificationType
  category  NotificationCategory
  
  // Status
  isRead    Boolean          @default(false) @map("is_read")
  readAt    DateTime?        @map("read_at")
  
  // Additional Data
  data      Json?            // additional notification data
  
  // Timestamp
  createdAt DateTime         @default(now()) @map("created_at")
  
  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

// ==============================================
// SYSTEM CONFIGURATION
// ==============================================

model SystemSettings {
  id          String   @id @default(uuid()) @db.Uuid
  key         String   @unique
  value       String
  description String?
  isPublic    Boolean  @default(false) @map("is_public")
  
  // Timestamps
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  @@map("system_settings")
}

// ==============================================
// ENUMS
// ==============================================

enum UserRole {
  FARMER
  GOVERNMENT_OFFICIAL
  ADMIN
}

enum Theme {
  LIGHT
  DARK
  SYSTEM
}

enum SoilType {
  ALLUVIAL
  CLAY
  SANDY
  LOAMY
  BLACK
  RED
  LATERITE
  MIXED
}

enum IrrigationType {
  DRIP
  SPRINKLER
  FLOOD
  RAINFED
  MIXED
}

enum FarmOwnership {
  OWNED
  LEASED
  SHARECROP
  OTHER
}

enum FarmingType {
  ORGANIC
  CONVENTIONAL
  MIXED
}

enum CropCategory {
  CEREALS
  PULSES
  OILSEEDS
  CASH_CROPS
  VEGETABLES
  FRUITS
}

enum FertilizerType {
  ORGANIC
  CHEMICAL
  MIXED
}

enum SeedQuality {
  HIGH
  MEDIUM
  LOW
}

enum InputMethod {
  MANUAL
  VOICE
  HYBRID
}

enum PredictionStatus {
  PENDING
  COMPLETED
  HARVESTED
}

enum DataSource {
  PRIMARY_API
  BACKUP_API
  CACHE
}

enum AuditStatus {
  SUCCESS
  FAILED
}

enum NotificationType {
  INFO
  WARNING
  ALERT
  SUCCESS
}

enum NotificationCategory {
  WEATHER
  PREDICTION
  SYSTEM
  MARKET
  ADVISORY
}